<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kahoot | –ù–æ–≤–æ—Å—Ç–∏</title>
    <link rel="stylesheet" href="/stylesheets/news.css">
    <link rel="icon" type="image/png" href="/images/icon.png">
</head>
<body>
<%- include('header.ejs') %>
<main class="news">
    <br>
    <br>
    <br>
    <br>
    <div class="search-container" id="searchContainer">
        <div class="search">
            <h3>–ü–æ–∏—Å–∫ —Å—Ç–∞—Ç–µ–π</h3>
            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" placeholder="–ü–æ–∏—Å–∫" id="searchInput">
                <span class="close-icon" id="closeIcon">‚úñ</span>
            </div>
            <br>
            <div class="search-info">
                <span>–ò—â–∏—Ç–µ –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º.</span>
            </div>
        </div>
        <br>
        <br>
        <div class="info-card" id="infoCard">
            <div class="info-image">
                <img src="/images/info-image.jpg">
            </div>
            <div class="info-content">
                <a>
                    <span class="info-title">
                        –ó–∞—á–µ–º —á–∏—Ç–∞—Ç—å –∏–≥—Ä–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏?
                    </span>
                </a>

                <p class="info-desc">
                    –ù–æ–≤–æ—Å—Ç–∏ –ø–æ–º–æ–≥–∞—é—Ç –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, –±–∞–≥–æ–≤, –ø–∞—Ç—á–µ–π –∏ –¥—Ä—É–≥–∏—Ö –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ –º–∏—Ä–µ –∏–≥—Ä—ã.
                    –ë–ª–∞–≥–æ–¥–∞—Ä—è –Ω–∏–º –≤—ã —É–∑–Ω–∞–µ—Ç–µ –æ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö, —É–ª—É—á—à–µ–Ω–∏—è—Ö –∏ –æ –º–Ω–æ–≥–æ–º –¥—Ä—É–≥–æ–º.
                </p>
            </div>
        </div>
    </div>
    <ul class="container" id="newsList">
        <div class="search-tag-container">
            <h4>–ü–æ–ø—É—Ä—è—Ä–Ω—ã–µ —Ç–µ–º—ã</h4>
            <div style="display: flex; gap: 10px;">
                <a href="?tag=Updates" class="tag search-tag" id="Updates">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</a>
                <a href="?tag=AboutGame" class="tag search-tag" id="AboutGame">–û–± –∏–≥—Ä–µ</a>
                <a href="?tag=BugsErrors" class="tag search-tag" id="BugsErrors">–ë–∞–≥–∏/–û—à–∏–±–∫–∏</a>
                <a href="/news" class="tag search-tag" id="AllNews">–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</a>
            </div>
        </div>
        <% if (allNews && allNews.length > 0) { %>
            <% allNews.forEach(news => { %>
                <% if (news.update && news.update.length > 0) { %>
                    <li class="news-container">
                        <article class="news-card">
                            <h2 class="news-title"><%= news.updateTitle.length > 50 ? news.updateTitle.slice(0, 50) + '...' : news.updateTitle %></h2>
                            <div class="news-meta">
                                <div class="news-author" onclick="window.open('/user-profile/<%= news.author.authorId %>', '_blank')">
                                    <span>–ê–≤—Ç–æ—Ä</span>
                                    <img src="<%= news.authorImage %>">
                                    <span><%= news.author.authorName %></span>
                                </div>
                                <span class="news-date">üìÖ <%= news.date %></span>
                                <div class="tags">
                                    <% if (news.tags && news.tags.length > 0) {%>
                                        <% news.tags.forEach(tags => { %>
                                            <a class="tag search-tag-active"><%= tags.tagName === 'Updates' ? '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ' : tags.tagName === 'AboutGame' ? '–û–± –∏–≥—Ä–µ' : tags.tagName === 'BugsErrors' ? '–ë–∞–≥–∏/–û—à–∏–±–∫–∏' : '–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏' %></a>
                                        <% }) %>
                                    <% } %>
                                </div>
                            </div>
                            <div class="news-image">
                                <% if (news.update[0] && news.update[0].image) {%>
                                    <img src="<%= news.update[0].image %>">
                                <% } %>
                            </div>
                            <%
                                function linkify(text) {
                                    const urlPattern = /(\bhttps?:\/\/[^\s<>]+[^\s<>,.?!])/gi;
                                    return text.replace(urlPattern, function(url) {
                                        return `<a href="${url}" target="_blank" rel="noopener noreferrer" class="a-link">${url}</a>`;
                                    });
                                }
                                const linkedMessage = linkify(news.update[0].content.length > 100 ? news.update[0].content.slice(0, 100) + '...' : news.update[0].content);
                            %>
                            <p class="news-summary"><%- linkedMessage %></p>

                            <div class="news-footer">
                                <div class="stats">
                                    <span style="font-size: 25px; font-weight: 600">&#128065;</span>
                                    <p style="margin-top: 11.5px;"><%= news.views %></p>
                                </div>
                                <form action="/viewNews/<%= news._id %>" method="POST">
                                    <button class="read-more">–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</button>
                                </form>
                            </div>
                        </article>
                    </li>
                <% } %>
            <% }) %>
        <% } else { %>
            <h3 class="not-found">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</h3>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
        <% } %>
        <h3 class="not-found" id="searchNotFound">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</h3>
        <%- include('../pagination.ejs') %>
    </ul>
</main>
<%- include('footer.ejs') %>
<script src="/javascripts/timer.js"></script>
<script src="/javascripts/news.js"></script>
</body>
</html>
